<!DOCTYPE html>
<html>
<head>
    <title>GUN + IndexedDB Account System</title>
    <!-- GUN Core Library -->
    <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
    <!-- GUN Security Encryption Authorization (SEA) -->
    <script src="https://cdn.jsdelivr.net/npm/gun/sea.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gun/lib/radix.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gun/lib/radisk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gun/lib/store.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gun/lib/rindexed.js"></script>
</head>
<body>
    <h1>Note System with GUN and IndexedDB</h1>

    <!-- Registration Form -->
    <div>
        <h2>Register</h2>
        <input id="reg-username" placeholder="Username">
        <input id="reg-password" type="password" placeholder="Password">
        <button onclick="register()">Register</button>
    </div>

    <!-- Login Form -->
    <div>
        <h2>Login</h2>
        <input id="login-username" placeholder="Username">
        <input id="login-password" type="password" placeholder="Password">
        <button onclick="login()">Login</button>
    </div>

    <!-- Note Section (Hidden by Default) -->
    <div id="note-section" style="display:none;">
        <h2>Welcome, <span id="user-name"></span></h2>
        <textarea id="note-content" placeholder="Your notes here..."></textarea>
        <button onclick="saveNote()">Save Note</button>
        <button onclick="logout()">Logout</button>
    </div>

    <script>
        // Initialize GUN with IndexedDB (default backend)
        const gun = Gun({
            peers: ['https://gun-manhattan.herokuapp.com/gun'], // Public relay node
            localStorage: false // Disable LocalStorage to prioritize IndexedDB
        });

        const user = gun.user(); // Initialize GUN user

        // User Registration
        function register() {
            const username = document.getElementById('reg-username').value;
            const password = document.getElementById('reg-password').value;

            user.create(username, password, ack => {
                if (ack.err) {
                    alert('Registration failed: ' + ack.err);
                } else {
                    alert('Registration successful!');
                }
            });
        }

        // User Login
        function login() {
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;

            user.auth(username, password, ack => {
                if (ack.err) {
                    alert('Login failed: ' + ack.err);
                } else {
                    document.getElementById('user-name').innerText = username;
                    document.getElementById('note-section').style.display = 'block';
                    loadNote();
                }
            });
        }

        // Load Note from GUN
        function loadNote() {
            user.get('note').on(data => {
                if (data) {
                    document.getElementById('note-content').value = data;
                }
            });
        }

        // Save Note to GUN
        function saveNote() {
            const content = document.getElementById('note-content').value;
            user.get('note').put(content, ack => {
                if (ack.err) {
                    alert('Failed to save note: ' + ack.err);
                } else {
                    alert('Note saved successfully!');
                }
            });
        }

        // Logout
        function logout() {
            user.leave();
            document.getElementById('note-section').style.display = 'none';
            alert('Logged out!');
        }
    </script>
</body>
</html>
